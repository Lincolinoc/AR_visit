<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>WebAR –≤–∏–∑–∏—Ç–∫–∞ ‚Äî –ø—Ä–∏–º–µ—Ä</title>
    <!-- –†–ê–ë–û–ß–ò–ï –≤–µ—Ä—Å–∏–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫ -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@master/aframe/build/aframe-ar.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@latest/dist/aframe-extras.loaders.min.js"></script>
    <style>
      body { 
        margin: 0; 
        overflow: hidden;
        font-family: Arial, sans-serif;
      }
      #loading {
        position: absolute;
        z-index: 5;
        left: 10px;
        top: 10px;
        background: rgba(255,255,255,0.9);
        padding: 12px 16px;
        border-radius: 8px;
        font-size: 14px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      }
      #debug {
        position: absolute;
        z-index: 5;
        left: 10px;
        bottom: 10px;
        background: rgba(0,0,0,0.9);
        color: #0f0;
        padding: 10px;
        border-radius: 8px;
        font-family: 'Courier New', monospace;
        font-size: 11px;
        max-width: 90%;
        max-height: 180px;
        overflow-y: auto;
        border: 1px solid #0f0;
      }
      #markerSwitch {
        position: absolute;
        z-index: 5;
        right: 10px;
        top: 10px;
        background: rgba(255,255,255,0.9);
        padding: 8px 12px;
        border-radius: 8px;
        font-size: 12px;
        cursor: pointer;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      }
    </style>
  </head>
  <body>
    <div id="loading">üì∑ –ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ –≤–∏–∑–∏—Ç–∫—É</div>
    <div id="markerSwitch">üîÑ –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –º–∞—Ä–∫–µ—Ä</div>
    <div id="debug"></div>
    
    <a-scene 
      embedded 
      arjs='sourceType: webcam; debugUIEnabled: false;'
      vr-mode-ui="enabled: false">
      
      <!-- –ú–∞—Ä–∫–µ—Ä —Å –≤–∞—à–∏–º pattern (–æ—Å–Ω–æ–≤–Ω–æ–π) -->
      <a-marker 
        type="pattern" 
        url="mycard.patt" 
        id="customMarker"
        smooth="true"
        smoothCount="5"
        smoothTolerance="0.01"
        smoothThreshold="2">
        
        <a-box color="blue" position="0 0.5 0" scale="0.5 0.5 0.5"></a-box>
        
        <a-entity 
          obj-model="obj: url(model.obj); mtl: url(model.mtl)"
          scale="2 2 2"
          rotation="0 180 0"
          position="0 0 0">
        </a-entity>
        
        <a-entity position="0 1 0" rotation="-20 0 0">
          <a-text 
            value="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤\n–î–∏–∑–∞–π–Ω–µ—Ä" 
            align="center" 
            width="1.6"
            color="#000">
          </a-text>
        </a-entity>
      </a-marker>
      
      <!-- –ó–∞–ø–∞—Å–Ω–æ–π –º–∞—Ä–∫–µ—Ä Hiro (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π) –¥–ª—è —Ç–µ—Å—Ç–∞ -->
      <a-marker 
        preset="hiro" 
        id="hiroMarker"
        visible="false"
        smooth="true">
        
        <a-box color="red" position="0 0.5 0" scale="0.5 0.5 0.5"></a-box>
        
        <a-entity 
          obj-model="obj: url(model.obj); mtl: url(model.mtl)"
          scale="2 2 2"
          rotation="0 180 0"
          position="0 0 0">
        </a-entity>
        
        <a-entity position="0 1 0" rotation="-20 0 0">
          <a-text 
            value="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤\n–î–∏–∑–∞–π–Ω–µ—Ä\n(HIRO —Ç–µ—Å—Ç)" 
            align="center" 
            width="1.6"
            color="#000">
          </a-text>
        </a-entity>
      </a-marker>
      
      <a-entity camera></a-entity>
    </a-scene>

    <script>
      const loading = document.getElementById('loading');
      const debug = document.getElementById('debug');
      const markerSwitch = document.getElementById('markerSwitch');
      
      let useCustomMarker = true;
      
      function log(msg) {
        console.log(msg);
        const time = new Date().toLocaleTimeString();
        debug.innerHTML += `[${time}] ${msg}<br>`;
        debug.scrollTop = debug.scrollHeight;
      }

      log('‚úì –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
      log('üì± ' + (navigator.userAgent.match(/iPhone|iPad|Android/) || ['Desktop'])[0]);

      // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–æ–≤
      markerSwitch.addEventListener('click', () => {
        useCustomMarker = !useCustomMarker;
        const customMarker = document.getElementById('customMarker');
        const hiroMarker = document.getElementById('hiroMarker');
        
        if (useCustomMarker) {
          customMarker.setAttribute('visible', 'true');
          hiroMarker.setAttribute('visible', 'false');
          markerSwitch.textContent = 'üîÑ ‚Üí Hiro —Ç–µ—Å—Ç';
          loading.textContent = 'üì∑ –ù–∞–≤–µ–¥–∏—Ç–µ –Ω–∞ –í–ê–®–£ –≤–∏–∑–∏—Ç–∫—É';
          log('üîÑ –ê–∫—Ç–∏–≤–µ–Ω –∫–∞—Å—Ç–æ–º–Ω—ã–π –º–∞—Ä–∫–µ—Ä');
        } else {
          customMarker.setAttribute('visible', 'false');
          hiroMarker.setAttribute('visible', 'true');
          markerSwitch.textContent = 'üîÑ ‚Üí –°–≤–æ—è –≤–∏–∑–∏—Ç–∫–∞';
          loading.textContent = 'üì∑ –ù–∞–≤–µ–¥–∏—Ç–µ –Ω–∞ HIRO –º–∞—Ä–∫–µ—Ä';
          log('üîÑ –ê–∫—Ç–∏–≤–µ–Ω Hiro –º–∞—Ä–∫–µ—Ä (—Ç–µ—Å—Ç)');
        }
      });

      // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ü–µ–Ω—ã
      const scene = document.querySelector('a-scene');
      
      scene.addEventListener('loaded', () => {
        log('‚úì A-Frame —Å—Ü–µ–Ω–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
      });

      // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–∞–º–µ—Ä—ã
      let cameraReady = false;
      const checkCamera = setInterval(() => {
        const video = document.querySelector('video');
        if (video && video.videoWidth > 0 && !cameraReady) {
          cameraReady = true;
          log('‚úì –ö–∞–º–µ—Ä–∞: ' + video.videoWidth + 'x' + video.videoHeight);
          loading.style.background = 'rgba(100,200,100,0.9)';
          clearInterval(checkCamera);
        }
      }, 500);

      setTimeout(() => {
        if (!cameraReady) {
          log('‚ö† –ö–∞–º–µ—Ä–∞ –Ω–µ —Å—Ç–∞—Ä—Ç–æ–≤–∞–ª–∞');
          loading.textContent = '‚ö† –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É';
          loading.style.background = 'rgba(255,100,0,0.9)';
        }
        clearInterval(checkCamera);
      }, 10000);

      // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –û–ë–û–ò–• –º–∞—Ä–∫–µ—Ä–æ–≤
      const customMarker = document.getElementById('customMarker');
      const hiroMarker = document.getElementById('hiroMarker');
      
      customMarker.addEventListener('markerFound', () => {
        log('üéØ –ö–ê–°–¢–û–ú–ù–´–ô –ú–ê–†–ö–ï–† –ù–ê–ô–î–ï–ù!');
        loading.textContent = '‚úì –í–∞—à –º–∞—Ä–∫–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç!';
        loading.style.background = 'rgba(0,255,0,0.9)';
      });

      customMarker.addEventListener('markerLost', () => {
        log('‚ö† –ö–∞—Å—Ç–æ–º–Ω—ã–π –º–∞—Ä–∫–µ—Ä –ø–æ—Ç–µ—Ä—è–Ω');
        loading.textContent = 'üì∑ –ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ –≤–∏–∑–∏—Ç–∫—É';
        loading.style.background = 'rgba(255,255,255,0.9)';
      });

      hiroMarker.addEventListener('markerFound', () => {
        log('üéØ HIRO –ú–ê–†–ö–ï–† –ù–ê–ô–î–ï–ù!');
        loading.textContent = '‚úì Hiro –º–∞—Ä–∫–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç!';
        loading.style.background = 'rgba(0,255,255,0.9)';
      });

      hiroMarker.addEventListener('markerLost', () => {
        log('‚ö† Hiro –º–∞—Ä–∫–µ—Ä –ø–æ—Ç–µ—Ä—è–Ω');
        loading.textContent = 'üì∑ –ù–∞–≤–µ–¥–∏—Ç–µ –Ω–∞ Hiro –º–∞—Ä–∫–µ—Ä';
        loading.style.background = 'rgba(255,255,255,0.9)';
      });

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ñ–∞–π–ª–æ–≤
      fetch('mycard.patt')
        .then(response => {
          if (response.ok) {
            return response.text();
          } else {
            throw new Error('HTTP ' + response.status);
          }
        })
        .then(text => {
          log('‚úì mycard.patt –Ω–∞–π–¥–µ–Ω (' + text.length + ' –±–∞–π—Ç)');
          // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞
          if (text.length < 100) {
            log('‚ö† –í–ù–ò–ú–ê–ù–ò–ï: —Ñ–∞–π–ª —Å–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–∏–π!');
          }
          if (!text.includes('255') && !text.includes('0')) {
            log('‚ö† –í–ù–ò–ú–ê–ù–ò–ï: –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç!');
          }
        })
        .catch(err => {
          log('‚úó mycard.patt –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ' + err.message);
          log('‚ÑπÔ∏è –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É "‚Üí Hiro —Ç–µ—Å—Ç"');
        });

      ['model.obj', 'model.mtl'].forEach(file => {
        fetch(file)
          .then(response => {
            if (response.ok) {
              log('‚úì ' + file + ' –Ω–∞–π–¥–µ–Ω');
            } else {
              log('‚ö† ' + file + ' (HTTP ' + response.status + ')');
            }
          })
          .catch(() => log('‚úó ' + file + ' –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω'));
      });

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTPS
      if (location.protocol === 'https:') {
        log('‚úì HTTPS –∞–∫—Ç–∏–≤–µ–Ω');
      } else {
        log('‚ö† HTTP (–Ω—É–∂–µ–Ω HTTPS)');
      }

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
      let errorCount = 0;
      window.addEventListener('error', (e) => {
        errorCount++;
        if (errorCount <= 3) { // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 3 –æ—à–∏–±–∫–∏
          log('‚úó –û—à–∏–±–∫–∞: ' + e.message.substring(0, 50));
        }
        
        // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ divide by zero
        if (e.message.includes('divide by zero')) {
          log('‚ö† –ü–†–û–ë–õ–ï–ú–ê –° –ú–ê–†–ö–ï–†–û–ú!');
          log('‚ÑπÔ∏è –ù–∞–∂–º–∏—Ç–µ "‚Üí Hiro —Ç–µ—Å—Ç"');
          markerSwitch.style.background = 'rgba(255,255,0,0.9)';
          markerSwitch.style.animation = 'pulse 1s infinite';
        }
      });
    </script>
  </body>
</html>







