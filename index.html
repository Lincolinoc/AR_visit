<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>WebAR –≤–∏–∑–∏—Ç–∫–∞ ‚Äî –ø—Ä–∏–º–µ—Ä</title>
    <!-- –†–ê–ë–û–ß–ò–ï –≤–µ—Ä—Å–∏–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫ -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@master/aframe/build/aframe-ar.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@latest/dist/aframe-extras.loaders.min.js"></script>
    <style>
      body { 
        margin: 0; 
        overflow: hidden;
        font-family: Arial, sans-serif;
      }
      #loading {
        position: absolute;
        z-index: 5;
        left: 10px;
        top: 10px;
        background: rgba(255,255,255,0.9);
        padding: 12px 16px;
        border-radius: 8px;
        font-size: 14px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      }
      #debug {
        position: absolute;
        z-index: 5;
        left: 10px;
        bottom: 10px;
        background: rgba(0,0,0,0.9);
        color: #0f0;
        padding: 10px;
        border-radius: 8px;
        font-family: 'Courier New', monospace;
        font-size: 11px;
        max-width: 90%;
        max-height: 180px;
        overflow-y: auto;
        border: 1px solid #0f0;
      }
    </style>
  </head>
  <body>
    <div id="loading">üì∑ –ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ –≤–∏–∑–∏—Ç–∫—É</div>
    <div id="debug"></div>
    
    <a-scene 
      embedded 
      arjs='sourceType: webcam; debugUIEnabled: false;'
      vr-mode-ui="enabled: false">
      
      <a-marker type="pattern" url="mycard.patt" id="marker">
        <!-- –¢–µ—Å—Ç–æ–≤—ã–π –∫—É–±–∏–∫ -->
        <a-box color="red" position="0 0.5 0" scale="0.5 0.5 0.5"></a-box>
        
        <!-- –í–∞—à–∞ 3D –º–æ–¥–µ–ª—å -->
        <a-entity 
          id="model"
          obj-model="obj: url(model.obj); mtl: url(model.mtl)"
          scale="2 2 2"
          rotation="0 180 0"
          position="0 0 0">
        </a-entity>
        
        <!-- –¢–µ–∫—Å—Ç —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π -->
        <a-entity position="0 1 0" rotation="-20 0 0">
          <a-text 
            value="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤\n–î–∏–∑–∞–π–Ω–µ—Ä" 
            align="center" 
            width="1.6"
            color="#000">
          </a-text>
        </a-entity>
      </a-marker>
      
      <a-entity camera></a-entity>
    </a-scene>

    <script>
      const loading = document.getElementById('loading');
      const debug = document.getElementById('debug');
      
      function log(msg) {
        console.log(msg);
        const time = new Date().toLocaleTimeString();
        debug.innerHTML += `[${time}] ${msg}<br>`;
        debug.scrollTop = debug.scrollHeight;
      }

      log('‚úì –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
      log('üì± –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: ' + (navigator.userAgent.match(/iPhone|iPad|Android/) || ['Desktop'])[0]);

      // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ü–µ–Ω—ã
      const scene = document.querySelector('a-scene');
      
      scene.addEventListener('loaded', () => {
        log('‚úì A-Frame —Å—Ü–µ–Ω–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
      });

      // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–∞–º–µ—Ä—ã
      let cameraReady = false;
      const checkCamera = setInterval(() => {
        const video = document.querySelector('video');
        if (video && video.videoWidth > 0 && !cameraReady) {
          cameraReady = true;
          log('‚úì –ö–∞–º–µ—Ä–∞ –∞–∫—Ç–∏–≤–Ω–∞: ' + video.videoWidth + 'x' + video.videoHeight);
          loading.style.background = 'rgba(100,200,100,0.9)';
          clearInterval(checkCamera);
        }
      }, 500);

      // –¢–∞–π–º–∞—É—Ç –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –∫–∞–º–µ—Ä—ã
      setTimeout(() => {
        if (!cameraReady) {
          log('‚ö† –ö–∞–º–µ—Ä–∞ –Ω–µ –∑–∞–ø—É—Å—Ç–∏–ª–∞—Å—å –∑–∞ 10 —Å–µ–∫—É–Ω–¥');
          loading.textContent = '‚ö† –ü—Ä–æ–±–ª–µ–º–∞ —Å –∫–∞–º–µ—Ä–æ–π. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É';
          loading.style.background = 'rgba(255,100,0,0.9)';
        }
        clearInterval(checkCamera);
      }, 10000);

      // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–∞
      const marker = document.getElementById('marker');
      
      marker.addEventListener('markerFound', () => {
        log('üéØ –ú–ê–†–ö–ï–† –ù–ê–ô–î–ï–ù!');
        loading.textContent = '‚úì –ú–∞—Ä–∫–µ—Ä –æ–±–Ω–∞—Ä—É–∂–µ–Ω!';
        loading.style.background = 'rgba(0,255,0,0.9)';
        loading.style.color = '#000';
      });

      marker.addEventListener('markerLost', () => {
        log('‚ö† –ú–∞—Ä–∫–µ—Ä –ø–æ—Ç–µ—Ä—è–Ω');
        loading.textContent = 'üì∑ –ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ –≤–∏–∑–∏—Ç–∫—É';
        loading.style.background = 'rgba(255,255,255,0.9)';
        loading.style.color = '#000';
      });

      // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏
      const model = document.getElementById('model');
      
      model.addEventListener('model-loaded', () => {
        log('‚úì 3D –º–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ');
      });

      model.addEventListener('model-error', (e) => {
        log('‚ö† –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏');
        console.error('Model error:', e);
      });

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ñ–∞–π–ª–æ–≤
      const filesToCheck = ['mycard.patt', 'model.obj', 'model.mtl'];
      filesToCheck.forEach(file => {
        fetch(file)
          .then(response => {
            if (response.ok) {
              log('‚úì –§–∞–π–ª –Ω–∞–π–¥–µ–Ω: ' + file);
            } else {
              log('‚úó –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: ' + file + ' (HTTP ' + response.status + ')');
            }
          })
          .catch(err => {
            log('‚úó –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + file);
          });
      });

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTPS
      if (location.protocol === 'https:') {
        log('‚úì HTTPS –∞–∫—Ç–∏–≤–µ–Ω');
      } else if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
        log('‚Ñπ Localhost (HTTPS –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è)');
      } else {
        log('‚ö† –í–ù–ò–ú–ê–ù–ò–ï: HTTP –≤–º–µ—Å—Ç–æ HTTPS!');
      }

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
      window.addEventListener('error', (e) => {
        log('‚úó JS –æ—à–∏–±–∫–∞: ' + e.message);
      });
    </script>
  </body>
</html>






