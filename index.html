<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>WebAR –≤–∏–∑–∏—Ç–∫–∞ ‚Äî –ø—Ä–∏–º–µ—Ä</title>
    <style>
      body { 
        margin: 0; 
        overflow: hidden;
        font-family: Arial, sans-serif;
      }
      #startScreen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 999;
      }
      #startBtn {
        background: white;
        color: #667eea;
        border: none;
        padding: 20px 40px;
        font-size: 18px;
        font-weight: bold;
        border-radius: 50px;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        transition: transform 0.2s;
      }
      #startBtn:active {
        transform: scale(0.95);
      }
      #startScreen h1 {
        color: white;
        margin-bottom: 20px;
        text-align: center;
        padding: 0 20px;
      }
      #startScreen p {
        color: rgba(255,255,255,0.9);
        margin-bottom: 30px;
        text-align: center;
        padding: 0 20px;
      }
      #loading {
        position: absolute;
        z-index: 5;
        left: 10px;
        top: 10px;
        background: rgba(255,255,255,0.9);
        padding: 12px 16px;
        border-radius: 8px;
        font-size: 14px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      }
      #debug {
        position: absolute;
        z-index: 5;
        left: 10px;
        bottom: 10px;
        background: rgba(0,0,0,0.9);
        color: #0f0;
        padding: 10px;
        border-radius: 8px;
        font-family: 'Courier New', monospace;
        font-size: 11px;
        max-width: 90%;
        max-height: 200px;
        overflow-y: auto;
        border: 1px solid #0f0;
      }
      .hidden {
        display: none !important;
      }
      /* –í–∞–∂–Ω–æ: —É–±–µ–¥–∏–º—Å—è —á—Ç–æ –≤–∏–¥–µ–æ –≤–∏–¥–Ω–æ */
      video {
        position: absolute;
        top: 0;
        left: 0;
        width: 100% !important;
        height: 100% !important;
        object-fit: cover;
      }
    </style>
  </head>
  <body>
    <div id="startScreen">
      <h1>üì± AR –í–∏–∑–∏—Ç–∫–∞</h1>
      <p>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∫–∞–º–µ—Ä—É<br>–∏ –Ω–∞–≤–µ—Å—Ç–∏ –µ—ë –Ω–∞ –≤–∏–∑–∏—Ç–∫—É</p>
      <button id="startBtn">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å AR</button>
    </div>

    <div id="loading" class="hidden">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</div>
    <div id="debug" class="hidden"></div>
    
    <!-- –°—Ü–µ–Ω–∞ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç–∞, –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∫–ª–∏–∫–∞ -->
    <div id="sceneContainer" class="hidden"></div>

    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@2.2.1/aframe/build/aframe-ar.js"></script>

    <script>
      const startScreen = document.getElementById('startScreen');
      const startBtn = document.getElementById('startBtn');
      const debug = document.getElementById('debug');
      const loading = document.getElementById('loading');
      const sceneContainer = document.getElementById('sceneContainer');
      
      function log(msg) {
        console.log(msg);
        debug.classList.remove('hidden');
        debug.innerHTML += msg + '<br>';
        debug.scrollTop = debug.scrollHeight;
      }

      log('‚úì –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
      log('üì± ' + navigator.userAgent.substring(0, 50) + '...');

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –∑–∞–ø—É—Å–∫–∞
      startBtn.addEventListener('click', () => {
        log('üöÄ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª –∫–Ω–æ–ø–∫—É');
        startBtn.disabled = true;
        startBtn.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';
        
        // –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω
        startScreen.classList.add('hidden');
        loading.classList.remove('hidden');
        loading.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ AR...';
        
        log('üé¨ –°–æ–∑–¥–∞–Ω–∏–µ AR —Å—Ü–µ–Ω—ã...');
        
        // –°–æ–∑–¥–∞—ë–º A-Frame —Å—Ü–µ–Ω—É –ü–û–°–õ–ï –∫–ª–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        sceneContainer.innerHTML = `
          <a-scene
            id="scene"
            vr-mode-ui="enabled: false"
            embedded
            arjs="sourceType: webcam; debugUIEnabled: false; patternRatio: 0.9;"
            renderer="logarithmicDepthBuffer: true;">
            
            <a-marker type="pattern" url="mycard.patt" id="marker">
              <a-box color="red" position="0 0.5 0" scale="0.5 0.5 0.5"></a-box>
              
              <a-entity
                id="model"
                obj-model="obj: url(model.obj); mtl: url(model.mtl)"
                scale="2 2 2"
                rotation="0 180 0"
                position="0 0 0">
              </a-entity>
              
              <a-entity position="0 1 0" rotation="-20 0 0">
                <a-text value="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤\n–î–∏–∑–∞–π–Ω–µ—Ä" align="center" width="1.6" color="#000"></a-text>
              </a-entity>
            </a-marker>
            
            <a-entity camera></a-entity>
          </a-scene>
        `;
        
        sceneContainer.classList.remove('hidden');
        
        // –ñ–¥—ë–º —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ü–µ–Ω—ã
        setTimeout(() => {
          const scene = document.getElementById('scene');
          if (!scene) {
            log('‚úó –°—Ü–µ–Ω–∞ –Ω–µ —Å–æ–∑–¥–∞–ª–∞—Å—å');
            return;
          }
          
          log('‚úì –°—Ü–µ–Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ DOM');
          
          // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ü–µ–Ω—ã
          scene.addEventListener('loaded', () => {
            log('‚úì A-Frame —Å—Ü–µ–Ω–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
          });

          // –ü—Ä–æ–≤–µ—Ä–∫–∞ AR.js
          scene.addEventListener('renderstart', () => {
            log('‚úì –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –Ω–∞—á–∞–ª—Å—è');
          });

          // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–∞–º–µ—Ä—ã
          let cameraCheckCount = 0;
          const cameraCheck = setInterval(() => {
            const video = document.querySelector('video');
            cameraCheckCount++;
            
            if (video) {
              log('‚úì –í–∏–¥–µ–æ —ç–ª–µ–º–µ–Ω—Ç –Ω–∞–π–¥–µ–Ω');
              log('  –†–∞–∑–º–µ—Ä: ' + video.videoWidth + 'x' + video.videoHeight);
              log('  –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ: ' + !video.paused);
              
              if (video.videoWidth > 0) {
                log('‚úì‚úì‚úì –ö–ê–ú–ï–†–ê –†–ê–ë–û–¢–ê–ï–¢!');
                loading.textContent = 'üì∑ –ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ –≤–∏–∑–∏—Ç–∫—É';
                loading.style.background = 'rgba(100,200,100,0.9)';
                clearInterval(cameraCheck);
              }
            } else {
              log('‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –≤–∏–¥–µ–æ... (' + cameraCheckCount + ')');
            }
            
            if (cameraCheckCount > 20) {
              log('‚úó –¢–∞–π–º–∞—É—Ç –æ–∂–∏–¥–∞–Ω–∏—è –∫–∞–º–µ—Ä—ã');
              loading.textContent = '‚ùå –ö–∞–º–µ—Ä–∞ –Ω–µ –∑–∞–ø—É—Å—Ç–∏–ª–∞—Å—å';
              loading.style.background = 'rgba(255,0,0,0.9)';
              loading.style.color = 'white';
              clearInterval(cameraCheck);
            }
          }, 500);

          // –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–∞
          setTimeout(() => {
            const marker = document.getElementById('marker');
            if (marker) {
              marker.addEventListener('markerFound', () => {
                log('‚úì‚úì‚úì –ú–ê–†–ö–ï–† –ù–ê–ô–î–ï–ù! üéØ');
                loading.style.background = 'rgba(0,255,0,0.9)';
                loading.textContent = '‚úì –ú–∞—Ä–∫–µ—Ä –æ–±–Ω–∞—Ä—É–∂–µ–Ω!';
              });

              marker.addEventListener('markerLost', () => {
                log('‚ö† –ú–∞—Ä–∫–µ—Ä –ø–æ—Ç–µ—Ä—è–Ω');
                loading.style.background = 'rgba(255,255,255,0.9)';
                loading.textContent = 'üì∑ –ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ –≤–∏–∑–∏—Ç–∫—É';
              });
            }
          }, 2000);

          // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏
          setTimeout(() => {
            const model = document.getElementById('model');
            if (model) {
              model.addEventListener('model-loaded', () => {
                log('‚úì 3D –º–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
              });
              model.addEventListener('model-error', (e) => {
                log('‚ö† –û—à–∏–±–∫–∞ –º–æ–¥–µ–ª–∏ (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)');
              });
            }
          }, 2000);
          
        }, 100);
      });

      // –û–±—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
      window.addEventListener('error', (e) => {
        log('‚úó –û–®–ò–ë–ö–ê: ' + e.message);
      });

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTPS
      if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
        log('‚ö† –í–ù–ò–ú–ê–ù–ò–ï: –ù–µ—Ç HTTPS! –ö–∞–º–µ—Ä–∞ –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å');
      } else {
        log('‚úì HTTPS –∞–∫—Ç–∏–≤–µ–Ω');
      }
    </script>
  </body>
</html>





