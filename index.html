<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>AR –í–∏–∑–∏—Ç–∫–∞ - WebXR</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            width: 100vw;
            height: 100vh;
            font-family: Arial, sans-serif;
            background: #000;
            overflow: hidden;
        }
        
        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }
        
        #ui {
            position: fixed;
            top: 15px;
            left: 15px;
            background: rgba(0, 0, 0, 0.95);
            color: #0f0;
            padding: 15px;
            border-radius: 5px;
            font-size: 12px;
            font-family: monospace;
            z-index: 999;
            border: 2px solid #0f0;
            max-width: 300px;
            line-height: 1.6;
        }
        
        #status {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 50, 0, 0.95);
            color: #0f0;
            padding: 12px 15px;
            border-radius: 5px;
            font-size: 13px;
            font-family: monospace;
            z-index: 999;
            border: 2px solid #0f0;
            font-weight: bold;
        }
        
        #controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            z-index: 999;
        }
        
        button {
            padding: 10px 12px;
            background: #0f0;
            color: #000;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 12px;
            transition: all 0.2s;
        }
        
        button:hover {
            background: #0c0;
            transform: scale(1.05);
        }
        
        button:active {
            transform: scale(0.95);
        }
        
        button:disabled {
            background: #888;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    
    <div id="ui">
        <div>üì° AR –í–∏–∑–∏—Ç–∫–∞</div>
        <div id="log">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</div>
        <div style="margin-top: 10px; font-size: 11px; color: #0a0;">
            ‚úì –ö–∞–º–µ—Ä–∞ –∞–∫—Ç–∏–≤–Ω–∞
        </div>
    </div>
    
    <div id="status">
        ‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...
    </div>
    
    <div id="controls">
        <button id="arButton" onclick="startAR()">üé• –ó–∞–ø—É—Å—Ç–∏—Ç—å AR</button>
        <button onclick="changeModel(0)">üü¶ –ö—É–±</button>
        <button onclick="changeModel(1)">üî∫ –°—Ñ–µ—Ä–∞</button>
        <button onclick="changeModel(2)">üü© –¢–æ—Ä</button>
    </div>

    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
    <script>
        let engine, scene, camera, light;
        let models = [];
        let currentModel = 0;
        let isARActive = false;

        const log = document.getElementById('log');
        const status = document.getElementById('status');
        const arButton = document.getElementById('arButton');

        function updateLog(text) {
            log.textContent = text;
            console.log(text);
        }

        function updateStatus(text) {
            status.textContent = text;
        }

        function changeModel(index) {
            models.forEach((m, i) => {
                m.isVisible = i === index;
            });
            currentModel = index;
            updateStatus(`‚úÖ –ú–æ–¥–µ–ª—å ${index + 1}`);
        }

        async function init() {
            updateLog('‚è≥ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Babylon.js...');

            const canvas = document.getElementById('canvas');
            engine = new BABYLON.Engine(canvas, true);

            scene = new BABYLON.Scene(engine);
            scene.collisionsEnabled = true;
            scene.useRightHandedSystem = true;

            camera = new BABYLON.UniversalCamera('camera', new BABYLON.Vector3(0, 1.6, 0), scene);
            camera.attachControl(canvas, true);
            camera.inertia = 0.7;
            camera.angularSensibility = 1000;

            light = new BABYLON.HemisphericLight('light', new BABYLON.Vector3(1, 1, 1), scene);
            light.intensity = 1;

            // –ö—É–±
            const cube = BABYLON.MeshBuilder.CreateBox('cube', { size: 0.5 }, scene);
            cube.position.z = 2;
            const cubeMat = new BABYLON.StandardMaterial('cubeMat', scene);
            cubeMat.diffuse = new BABYLON.Color3(1, 0, 0);
            cube.material = cubeMat;
            models.push(cube);

            // –°—Ñ–µ—Ä–∞
            const sphere = BABYLON.MeshBuilder.CreateSphere('sphere', { diameter: 0.5 }, scene);
            sphere.position.z = 2;
            sphere.isVisible = false;
            const sphereMat = new BABYLON.StandardMaterial('sphereMat', scene);
            sphereMat.diffuse = new BABYLON.Color3(0, 1, 0);
            sphere.material = sphereMat;
            models.push(sphere);

            // –¢–æ—Ä
            const torus = BABYLON.MeshBuilder.CreateTorus('torus', { diameter: 0.5, thickness: 0.2 }, scene);
            torus.position.z = 2;
            torus.isVisible = false;
            const torusMat = new BABYLON.StandardMaterial('torusMat', scene);
            torusMat.diffuse = new BABYLON.Color3(0, 0, 1);
            torus.material = torusMat;
            models.push(torus);

            // –¢–µ–∫—Å—Ç
            const textPlane = BABYLON.MeshBuilder.CreateBox('text', { width: 1, height: 0.3, depth: 0.05 }, scene);
            textPlane.position.z = 2;
            textPlane.position.y = 0.8;
            const textMat = new BABYLON.StandardMaterial('textMat', scene);
            textMat.diffuse = new BABYLON.Color3(0, 1, 1);
            textPlane.material = textMat;

            // –ê–Ω–∏–º–∞—Ü–∏—è
            scene.registerBeforeRender(() => {
                models.forEach(model => {
                    if (model.isVisible) {
                        model.rotation.x += 0.01;
                        model.rotation.y += 0.01;
                    }
                });
                textPlane.position.y = 0.8 + Math.sin(Date.now() * 0.003) * 0.1;
            });

            window.addEventListener('resize', () => {
                engine.resize();
            });

            engine.runRenderLoop(() => {
                scene.render();
            });

            updateLog('‚úÖ Babylon.js –≥–æ—Ç–æ–≤!');
            updateStatus('‚úÖ –ì–æ—Ç–æ–≤–æ!');
            arButton.disabled = false;
        }

        async function startAR() {
            updateLog('‚è≥ –ó–∞–ø—É—Å–∫ AR...');
            
            if (!navigator.mediaDevices) {
                updateLog('‚ùå –ö–∞–º–µ—Ä–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞');
                return;
            }

            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'environment' } 
                });
                
                updateLog('‚úÖ –ö–∞–º–µ—Ä–∞ –≤–∫–ª—é—á–µ–Ω–∞!');
                updateStatus('‚úÖ AR –∞–∫—Ç–∏–≤–Ω–∞!');
                isARActive = true;

                // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ—Ç–æ–∫ (–ø—Ä–æ—Å—Ç–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏)
                stream.getTracks().forEach(track => track.stop());
            } catch (err) {
                updateLog('‚ùå –û—à–∏–±–∫–∞: ' + err.message);
            }
        }

        window.addEventListener('load', init);
    </script>
</body>
</html>





