<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>WebAR –≤–∏–∑–∏—Ç–∫–∞ ‚Äî –ø—Ä–∏–º–µ—Ä</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@2.2.1/aframe/build/aframe-ar.js"></script>
    <style>
      body { 
        margin: 0; 
        overflow: hidden;
        font-family: Arial, sans-serif;
      }
      #startScreen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 999;
      }
      #startBtn {
        background: white;
        color: #667eea;
        border: none;
        padding: 20px 40px;
        font-size: 18px;
        font-weight: bold;
        border-radius: 50px;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        transition: transform 0.2s;
      }
      #startBtn:active {
        transform: scale(0.95);
      }
      #startScreen h1 {
        color: white;
        margin-bottom: 20px;
        text-align: center;
        padding: 0 20px;
      }
      #startScreen p {
        color: rgba(255,255,255,0.9);
        margin-bottom: 30px;
        text-align: center;
        padding: 0 20px;
      }
      #loading {
        position: absolute;
        z-index: 5;
        left: 10px;
        top: 10px;
        background: rgba(255,255,255,0.9);
        padding: 12px 16px;
        border-radius: 8px;
        font-size: 14px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      }
      #debug {
        position: absolute;
        z-index: 5;
        left: 10px;
        bottom: 10px;
        background: rgba(0,0,0,0.9);
        color: #0f0;
        padding: 10px;
        border-radius: 8px;
        font-family: 'Courier New', monospace;
        font-size: 11px;
        max-width: 90%;
        max-height: 200px;
        overflow-y: auto;
        border: 1px solid #0f0;
      }
      .hidden {
        display: none !important;
      }
    </style>
  </head>
  <body>
    <div id="startScreen">
      <h1>üì± AR –í–∏–∑–∏—Ç–∫–∞</h1>
      <p>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∫–∞–º–µ—Ä—É<br>–∏ –Ω–∞–≤–µ—Å—Ç–∏ –µ—ë –Ω–∞ –≤–∏–∑–∏—Ç–∫—É</p>
      <button id="startBtn">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å AR</button>
    </div>

    <div id="loading" class="hidden">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</div>
    <div id="debug" class="hidden"></div>
    
    <a-scene
      id="scene"
      vr-mode-ui="enabled: false"
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false; patternRatio: 0.9; trackingMethod: best;"
      renderer="logarithmicDepthBuffer: true; precision: medium;">
      
      <a-marker type="pattern" url="mycard.patt" id="marker">
        <a-box color="red" position="0 0.5 0" scale="0.5 0.5 0.5"></a-box>
        
        <a-entity
          id="model"
          obj-model="obj: url(model.obj); mtl: url(model.mtl)"
          scale="2 2 2"
          rotation="0 180 0"
          position="0 0 0">
        </a-entity>
        
        <a-entity position="0 1 0" rotation="-20 0 0">
          <a-text value="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤\n–î–∏–∑–∞–π–Ω–µ—Ä" align="center" width="1.6" color="#000"></a-text>
        </a-entity>
      </a-marker>
      
      <a-entity camera></a-entity>
    </a-scene>

    <script>
      const startScreen = document.getElementById('startScreen');
      const startBtn = document.getElementById('startBtn');
      const debug = document.getElementById('debug');
      const loading = document.getElementById('loading');
      const scene = document.getElementById('scene');
      
      let cameraStarted = false;
      
      function log(msg) {
        console.log(msg);
        debug.classList.remove('hidden');
        debug.innerHTML += msg + '<br>';
        debug.scrollTop = debug.scrollHeight;
      }

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –∑–∞–ø—É—Å–∫–∞
      startBtn.addEventListener('click', async () => {
        log('üöÄ –ó–∞–ø—É—Å–∫ AR...');
        startBtn.disabled = true;
        startBtn.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';
        
        try {
          // –Ø–≤–Ω–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ
          log('üì∑ –ó–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ...');
          const stream = await navigator.mediaDevices.getUserMedia({ 
            video: { 
              facingMode: 'environment',
              width: { ideal: 1280 },
              height: { ideal: 720 }
            } 
          });
          
          log('‚úì –î–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ –ø–æ–ª—É—á–µ–Ω');
          cameraStarted = true;
          
          // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ—Ç–æ–∫, AR.js —Å–∞–º —Å–æ–∑–¥–∞—Å—Ç –Ω–æ–≤—ã–π
          stream.getTracks().forEach(track => track.stop());
          
          // –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω
          startScreen.classList.add('hidden');
          loading.classList.remove('hidden');
          loading.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ AR...';
          
          // –î–∞—ë–º A-Frame –≤—Ä–µ–º—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è
          setTimeout(() => {
            log('‚úì A-Frame –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
          }, 1000);
          
        } catch (error) {
          log('‚úó –û–®–ò–ë–ö–ê –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ: ' + error.message);
          startBtn.disabled = false;
          startBtn.textContent = 'üöÄ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞';
          alert('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ:\n' + error.message + '\n\n–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:\n1. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ª–∏ –≤—ã HTTPS\n2. –†–∞–∑—Ä–µ—à—ë–Ω –ª–∏ –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞\n3. –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ –∫–∞–º–µ—Ä–∞ –¥—Ä—É–≥–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º');
        }
      });

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ü–µ–Ω—ã
      scene.addEventListener('loaded', () => {
        log('‚úì A-Frame —Å—Ü–µ–Ω–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
      });

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ AR.js
      window.addEventListener('arjs-video-loaded', () => {
        log('‚úì –ö–∞–º–µ—Ä–∞ AR.js –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
        loading.textContent = 'üì∑ –ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ –≤–∏–∑–∏—Ç–∫—É';
        loading.style.background = 'rgba(100,200,100,0.9)';
      });

      // –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–∞
      const marker = document.getElementById('marker');
      if (marker) {
        marker.addEventListener('markerFound', () => {
          log('‚úì –ú–ê–†–ö–ï–† –ù–ê–ô–î–ï–ù! üéØ');
          loading.style.background = 'rgba(0,255,0,0.9)';
          loading.textContent = '‚úì –ú–∞—Ä–∫–µ—Ä –æ–±–Ω–∞—Ä—É–∂–µ–Ω!';
        });

        marker.addEventListener('markerLost', () => {
          log('‚ö† –ú–∞—Ä–∫–µ—Ä –ø–æ—Ç–µ—Ä—è–Ω');
          loading.style.background = 'rgba(255,255,255,0.9)';
          loading.textContent = 'üì∑ –ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ –≤–∏–∑–∏—Ç–∫—É';
        });
      }

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏
      const model = document.getElementById('model');
      if (model) {
        model.addEventListener('model-loaded', () => {
          log('‚úì 3D –º–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
        });
        model.addEventListener('model-error', (e) => {
          log('‚úó –û—à–∏–±–∫–∞ –º–æ–¥–µ–ª–∏: ' + (e.detail || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è'));
        });
      }

      // –û–±—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
      window.addEventListener('error', (e) => {
        log('‚úó JS –û–®–ò–ë–ö–ê: ' + e.message);
      });

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∏–¥–µ–æ —á–µ—Ä–µ–∑ 7 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞
      let checkVideoTimeout;
      window.addEventListener('arjs-video-loaded', () => {
        clearTimeout(checkVideoTimeout);
        checkVideoTimeout = setTimeout(() => {
          const video = document.querySelector('video');
          if (!video || !video.srcObject) {
            log('‚úó –í–∏–¥–µ–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏');
            loading.textContent = '–û—à–∏–±–∫–∞ –∫–∞–º–µ—Ä—ã. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É';
            loading.style.background = 'rgba(255,0,0,0.9)';
            loading.style.color = 'white';
          } else {
            log('‚úì –í–∏–¥–µ–æ–ø–æ—Ç–æ–∫ –∞–∫—Ç–∏–≤–µ–Ω: ' + video.videoWidth + 'x' + video.videoHeight);
          }
        }, 7000);
      });

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTPS
      if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
        log('‚ö† –í–ù–ò–ú–ê–ù–ò–ï: –°–∞–π—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ —á–µ—Ä–µ–∑ HTTPS!');
        log('–ö–∞–º–µ—Ä–∞ –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ HTTPS');
      } else {
        log('‚úì –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ HTTPS');
      }

      // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
      log('üì± –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: ' + (navigator.userAgent.match(/iPhone|iPad|Android/) || ['Desktop'])[0]);
      log('üåê –ë—Ä–∞—É–∑–µ—Ä: ' + (navigator.userAgent.match(/Safari|Chrome|Firefox/) || ['Unknown'])[0]);
    </script>
  </body>
</html>







